(ns advent-of-code-2020.day20-test
  (:require
   [clojure.test :refer :all]
   [advent-of-code-2020.day20 :refer :all]))

(defonce ^:private example-input
  "Tile 2311:
..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###

Tile 1951:
#.##...##.
#.####...#
.....#..##
#...######
.##.#....#
.###.#####
###.##.##.
.###....#.
..#.#..#.#
#...##.#..

Tile 1171:
####...##.
#..##.#..#
##.#..#.#.
.###.####.
..###.####
.##....##.
.#...####.
#.##.####.
####..#...
.....##...

Tile 1427:
###.##.#..
.#..#.##..
.#.##.#..#
#.#.#.##.#
....#...##
...##..##.
...#.#####
.#.####.#.
..#..###.#
..##.#..#.

Tile 1489:
##.#.#....
..##...#..
.##..##...
..#...#...
#####...#.
#..#.#.#.#
...#.#.#..
##.#...##.
..##.##.##
###.##.#..

Tile 2473:
#....####.
#..#.##...
#.##..#...
######.#.#
.#...#.#.#
.#########
.###.#..#.
########.#
##...##.#.
..###.#.#.

Tile 2971:
..#.#....#
#...###...
#.#.###...
##.##..#..
.#####..##
.#..####.#
#..#.#..#.
..####.###
..#.#.###.
...#.#.#.#

Tile 2729:
...#.#.#.#
####.#....
..#.#.....
....#..#.#
.##..##.#.
.#.####...
####.#.#..
##.####...
##..#.##..
#.##...##.

Tile 3079:
#.#.#####.
.#..######
..#.......
######....
####.#..#.
.#...#.##.
#.#####.##
..#.###...
..#.......
..#.###...")

(deftest day20-read-example-input-test
  (testing "Day 20 - Part 1 - read example-input"
    (is (= [{:image {:height 10
                     :width 10
                     [0 1] 1 [0 2] 1 [0 3] 1 [0 4] 1 [0 5] 1 [0 8] 1
                     [1 1] 1 [1 3] 1 [1 4] 1 [1 5] 1 [1 6] 1 [1 8] 1
                     [2 0] 1 [2 3] 1 [2 7] 1 [2 8] 1 [2 9] 1
                     [3 0] 1 [3 3] 1 [3 4] 1 [3 6] 1 [3 9] 1
                     [4 1] 1 [4 2] 1 [4 4] 1 [4 9] 1
                     [5 0] 1 [5 2] 1 [5 3] 1 [5 5] 1 [5 6] 1
                     [6 4] 1 [6 8] 1
                     [7 4] 1 [7 5] 1 [7 7] 1 [7 9] 1
                     [8 0] 1 [8 2] 1 [8 4] 1 [8 5] 1 [8 6] 1 [8 8] 1 [8 9] 1
                     [9 3] 1 [9 5] 1 [9 6] 1 [9 9] 1}
             :tile-id 2311}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 1] 1 [0 3] 1 [0 6] 1 [0 9] 1
                     [1 4] 1 [1 5] 1 [1 6] 1 [1 7] 1
                     [2 0] 1 [2 1] 1 [2 4] 1 [2 5] 1 [2 6] 1 [2 7] 1 [2 8] 1
                     [3 0] 1 [3 1] 1 [3 5] 1 [3 7] 1
                     [4 1] 1 [4 3] 1 [4 4] 1 [4 6] 1 [4 8] 1 [4 9] 1
                     [5 1] 1 [5 2] 1 [5 3] 1 [5 5] 1 [5 6] 1 [5 9] 1
                     [6 3] 1 [6 5] 1
                     [7 0] 1 [7 3] 1 [7 5] 1 [7 6] 1 [7 8] 1 [7 9] 1
                     [8 0] 1 [8 2] 1 [8 3] 1 [8 5] 1 [8 6] 1 [8 7] 1
                     [9 1] 1 [9 2] 1 [9 3] 1 [9 4] 1 [9 5] 1 [9 8] 1}
             :tile-id 1951}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 1] 1 [0 2] 1 [0 7] 1 [0 8] 1
                     [1 0] 1 [1 2] 1 [1 3] 1 [1 5] 1 [1 6] 1 [1 8] 1
                     [2 0] 1 [2 3] 1 [2 4] 1 [2 5] 1 [2 7] 1 [2 8] 1
                     [3 0] 1 [3 1] 1 [3 2] 1 [3 3] 1 [3 4] 1 [3 7] 1 [3 8] 1
                     [4 1] 1 [4 4] 1
                     [5 3] 1 [5 6] 1 [5 7] 1 [5 9] 1
                     [6 1] 1 [6 2] 1 [6 3] 1 [6 4] 1 [6 6] 1 [6 7] 1 [6 8] 1 [6 9] 1
                     [7 0] 1 [7 3] 1 [7 4] 1 [7 5] 1 [7 6] 1 [7 7] 1
                     [8 0] 1 [8 2] 1 [8 3] 1 [8 4] 1 [8 5] 1 [8 6] 1 [8 7] 1
                     [9 1] 1 [9 4] 1}
             :tile-id 1171}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 3] 1
                     [1 0] 1 [1 1] 1 [1 2] 1 [1 7] 1
                     [2 0] 1 [2 3] 1 [2 8] 1 [2 9] 1
                     [3 2] 1 [3 5] 1 [3 6] 1 [3 7] 1 [3 9] 1
                     [4 0] 1 [4 1] 1 [4 2] 1 [4 3] 1 [4 4] 1 [4 5] 1 [4 7] 1
                     [5 0] 1 [5 6] 1 [5 7] 1 [5 8] 1 [5 9] 1
                     [6 1] 1 [6 2] 1 [6 3] 1 [6 6] 1 [6 7] 1 [6 8] 1
                     [7 0] 1 [7 1] 1 [7 3] 1 [7 5] 1 [7 6] 1 [7 8] 1
                     [8 4] 1 [8 5] 1 [8 6] 1 [8 7] 1 [8 9] 1
                     [9 2] 1 [9 3] 1 [9 4] 1 [9 6] 1 [9 8] 1}
             :tile-id 1427}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 4] 1 [0 5] 1 [0 7] 1 [0 9] 1
                     [1 0] 1 [1 2] 1 [1 4] 1 [1 7] 1 [1 9] 1
                     [2 1] 1 [2 2] 1 [2 3] 1 [2 4] 1 [2 8] 1 [2 9] 1
                     [3 0] 1 [3 1] 1 [3 4] 1 [3 5] 1 [3 6] 1 [3 7] 1 [3 8] 1
                     [4 4] 1 [4 9] 1
                     [5 0] 1 [5 2] 1 [5 5] 1 [5 6] 1 [5 8] 1 [5 9] 1
                     [6 2] 1 [6 3] 1 [6 8] 1
                     [7 1] 1 [7 5] 1 [7 6] 1 [7 7] 1 [7 9] 1
                     [8 4] 1 [8 7] 1 [8 8] 1
                     [9 5] 1 [9 8] 1}
             :tile-id 1489}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 1] 1 [0 2] 1 [0 3] 1 [0 7] 1 [0 8] 1
                     [1 3] 1 [1 4] 1 [1 5] 1 [1 6] 1 [1 7] 1 [1 8] 1
                     [2 2] 1 [2 3] 1 [2 5] 1 [2 6] 1 [2 7] 1 [2 9] 1
                     [3 1] 1 [3 2] 1 [3 3] 1 [3 5] 1 [3 6] 1 [3 7] 1 [3 9] 1
                     [4 3] 1 [4 5] 1 [4 7] 1 [4 9] 1
                     [5 0] 1 [5 1] 1 [5 3] 1 [5 4] 1 [5 5] 1 [5 6] 1 [5 7] 1 [5 8] 1
                     [6 0] 1 [6 1] 1 [6 2] 1 [6 5] 1 [6 7] 1 [6 8] 1 [6 9] 1
                     [7 0] 1 [7 3] 1 [7 4] 1 [7 5] 1 [7 7] 1
                     [8 0] 1 [8 5] 1 [8 6] 1 [8 8] 1 [8 9] 1
                     [9 3] 1 [9 4] 1 [9 5] 1 [9 7] 1}
             :tile-id 2473}
            {:image {:height 10
                     :width 10
                     [0 1] 1 [0 2] 1 [0 3] 1 [0 6] 1
                     [1 3] 1 [1 4] 1 [1 5] 1
                     [2 0] 1 [2 2] 1 [2 4] 1 [2 7] 1 [2 8] 1
                     [3 3] 1 [3 4] 1 [3 6] 1 [3 7] 1 [3 9] 1
                     [4 0] 1 [4 1] 1 [4 2] 1 [4 3] 1 [4 4] 1 [4 5] 1 [4 7] 1 [4 8] 1
                     [5 1] 1 [5 2] 1 [5 4] 1 [5 5] 1 [5 6] 1 [5 7] 1 [5 9] 1
                     [6 1] 1 [6 2] 1 [6 5] 1 [6 8] 1
                     [7 3] 1 [7 5] 1 [7 7] 1 [7 8] 1 [7 9] 1
                     [8 4] 1 [8 6] 1 [8 7] 1 [8 8] 1 [9 0] 1 [9 4] 1 [9 5] 1 [9 7] 1 [9 9] 1}
             :tile-id 2971}
            {:image {:height 10
                     :width 10
                     [0 1] 1 [0 6] 1 [0 7] 1 [0 8] 1 [0 9] 1
                     [1 1] 1 [1 4] 1 [1 5] 1 [1 6] 1 [1 7] 1 [1 8] 1
                     [2 1] 1 [2 2] 1 [2 4] 1 [2 6] 1 [2 9] 1
                     [3 0] 1 [3 1] 1 [3 5] 1 [3 6] 1 [3 7] 1 [3 9] 1
                     [4 2] 1 [4 3] 1 [4 5] 1 [4 7] 1 [4 8] 1
                     [5 0] 1 [5 1] 1 [5 4] 1 [5 5] 1 [5 6] 1 [5 7] 1
                     [6 4] 1 [6 5] 1 [6 7] 1 [6 8] 1
                     [7 0] 1 [7 3] 1 [7 6] 1 [7 8] 1 [7 9] 1
                     [8 4] 1 [8 9] 1 [9 0] 1 [9 3] 1}
             :tile-id 2729}
            {:image {:height 10
                     :width 10
                     [0 0] 1 [0 3] 1 [0 4] 1 [0 6] 1
                     [1 1] 1 [1 3] 1 [1 4] 1 [1 5] 1
                     [2 0] 1 [2 2] 1 [2 3] 1 [2 4] 1 [2 6] 1 [2 7] 1 [2 8] 1 [2 9] 1
                     [3 3] 1 [3 4] 1 [3 6] 1 [4 0] 1 [4 1] 1 [4 3] 1 [4 6] 1 [4 7] 1 [4 9] 1
                     [5 0] 1 [5 1] 1 [5 3] 1 [5 4] 1 [5 5] 1 [5 6] 1 [5 7] 1 [5 9] 1
                     [6 0] 1 [6 1] 1 [6 6] 1 [6 7] 1 [6 9] 1
                     [7 0] 1 [7 1] 1 [7 5] 1
                     [8 0] 1 [8 1] 1 [8 4] 1 [8 5] 1 [8 6] 1
                     [9 1] 1 [9 6] 1}
             :tile-id 3079}]
           (#'advent-of-code-2020.day20/read-input example-input)))))

(deftest day20-example-serialize-edges-test
  (testing "Day 20 - Part 1 - serialize-edges"
    (let [im {:height 10
              :width 10
              [0 1] 1 [0 2] 1 [0 3] 1 [0 4] 1 [0 5] 1 [0 8] 1
              [1 1] 1 [1 3] 1 [1 4] 1 [1 5] 1 [1 6] 1 [1 8] 1
              [2 0] 1 [2 3] 1 [2 7] 1 [2 8] 1 [2 9] 1
              [3 0] 1 [3 3] 1 [3 4] 1 [3 6] 1 [3 9] 1
              [4 1] 1 [4 2] 1 [4 4] 1 [4 9] 1
              [5 0] 1 [5 2] 1 [5 3] 1 [5 5] 1 [5 6] 1
              [6 4] 1 [6 8] 1 [7 4] 1 [7 5] 1 [7 7] 1 [7 9] 1
              [8 0] 1 [8 2] 1 [8 4] 1 [8 5] 1 [8 6] 1 [8 8] 1 [8 9] 1
              [9 3] 1 [9 5] 1 [9 6] 1 [9 9] 1}]
      (is (= {:north [210 300]
              :east [89 616]
              :south [231 924]
              :west [498 318]
              :flipped false}
             (#'advent-of-code-2020.day20/serialize-edges im))))))

(deftest day20-example-rotate-edges-test
  (testing "Day 20 - Part 1 - rotate-edges"
    (let [edges {:north [210 300]
                 :east [89 616]
                 :south [231 924]
                 :west [498 318]
                 :flipped false}]
      (is (= {:north [498 318]
              :east [210 300]
              :south [89 616]
              :west [231 924]
              :flipped false}
             (#'advent-of-code-2020.day20/rotate-edges edges))))))

(deftest day20-example-flip-edges-test
  (testing "Day 20 - Part 1 - flip-edges"
    (let [edges {:north [210 300]
                 :east [89 616]
                 :south [231 924]
                 :west [498 318]
                 :flipped false}]
      (is (= {:north [210 300]
              :east [89 616]
              :south [231 924]
              :west [498 318]
              :flipped true}
             (#'advent-of-code-2020.day20/flip-edges edges))))))

(deftest day20-example-get-edges-test
  (testing "Day 20 - Part 1 - get-edges"
    (let [edges {:north [210 300]
                 :east [89 616]
                 :south [231 924]
                 :west [498 318]
                 :flipped false}]
      (are [x y] (= x y)
        [210 89 231 498] (#'advent-of-code-2020.day20/get-edges edges)
        [300 616 924 318] (#'advent-of-code-2020.day20/get-edges
                           (assoc edges :flipped true))))))

(deftest day20-1-example-test
  (testing "Day 20 - Part 1 - example"
    (is (= 20899048083289
           (day20-1
            (#'advent-of-code-2020.day20/read-input example-input))))))

(deftest day20-1-test
  (testing "Day 20 - Part 1"
    (is (= 79412832860579 (day20-1)))))